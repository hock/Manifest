/*! Manifest 2021-06-02 */

const http=require("http"),hostname="localhost",port=3e3,url=require("url"),server=http.createServer((e,t)=>{var o,s=require("request-promise"),r={g:null,r:null,getSmapGeo:function(e){return s({method:"GET",uri:"https://raw.githubusercontent.com/hock/smapdata/master/data/"+e+".geojson",json:!0})},getSmapGraph:function(e){return s({method:"GET",uri:"https://raw.githubusercontent.com/hock/smapdata/master/data/"+e+".json",json:!0})},getGoogleOverview:function(e){return s({method:"GET",uri:"https://spreadsheets.google.com/feeds/cells/"+e+"/1/public/full?alt=json",json:!0})},getGoogleList:function(e){return s({method:"GET",uri:"https://spreadsheets.google.com/feeds/cells/"+e+"/2/public/full?alt=json",json:!0})},getMarineTrafficOverview:function(){return s({method:"GET",uri:"http://services.marinetraffic.com/api/exportvessels/cc503f48eb2c8e49549cc56de3c7059c4b042931/timespan:4/protocol:json",json:!0})}},n=url.parse(e.url,!0).query;"smap"!=n.type&&"gsheet"!=n.type||(o=e=null,"smap"==n.type&&(e=r.getSmapGeo,o=r.getSmapGraph),"gsheet"==n.type&&(e=r.getGoogleOverview,o=r.getGoogleList),e(n.id).then(function(e){r.g=e,o(n.id).then(function(e){r.r=e,t.statusCode=200,t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept"),t.setHeader("Access-Control-Allow-Methods","GET"),t.setHeader("Content-Type","application/json"),console.log("process success!"),t.end('{"g": '+JSON.stringify(r.g)+', "r": '+JSON.stringify(r.r)+"}")})}).catch(function(e){console.log("failure!"),t.statusCode=404,t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept"),t.setHeader("Access-Control-Allow-Methods","GET"),t.setHeader("Content-Type","application/json"),t.end('{"error: "RESOURCE NOT FOUND"}')})),"proxy"==n.type&&"marinetraffic-overview"==n.id&&(console.log("in marine"),r.getMarineTrafficOverview().then(function(e){console.log(e),t.statusCode=200,t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept"),t.setHeader("Access-Control-Allow-Methods","GET"),t.setHeader("Content-Type","application/json"),console.log("proxy success!"),console.log(e),t.end(JSON.stringify(e))}).catch(function(e){console.log("failure!"),t.statusCode=404,t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept"),t.setHeader("Access-Control-Allow-Methods","GET"),t.setHeader("Content-Type","application/json"),t.end('{"error: "RESOURCE NOT FOUND"}')}))});server.listen(port,hostname,()=>{console.log(`Server running at http://${hostname}:${port}/`)});