/*! Manifest 2021-11-03 */

const http=require("http"),hostname="localhost",port=3e3,url=require("url"),gsheetkey="AIzaSyDbKq9njfiQa3UDGzRaaG0YaQOT0kYNoFQ",aprsfikey="161937.xJdpU4VkxgfJ2EA",server=http.createServer((e,t)=>{var s,o=require("request-promise"),r={g:null,r:null,getSmapGeo:function(e){return o({method:"GET",uri:"https://raw.githubusercontent.com/hock/smapdata/master/data/"+e+".geojson",json:!0})},getSmapGraph:function(e){return o({method:"GET",uri:"https://raw.githubusercontent.com/hock/smapdata/master/data/"+e+".json",json:!0})},getGoogleOverview:function(e){return o({uri:"https://sheets.googleapis.com/v4/spreadsheets/"+e+"/values/Overview?key="+gsheetkey,json:!0})},getGoogleList:function(e){return o({method:"GET",uri:"https://sheets.googleapis.com/v4/spreadsheets/"+e+"/values/List?key="+gsheetkey,json:!0})},getMarineTrafficOverview:function(){return o({method:"GET",uri:"http://services.marinetraffic.com/api/exportvessels/cc503f48eb2c8e49549cc56de3c7059c4b042931/timespan:4/protocol:json",json:!0})},getAprsFi:function(e){return o({method:"GET",uri:"https://api.aprs.fi/api/get?name="+e+"&what=loc&apikey="+aprsfikey+"&format=json",headers:{"User-Agent":"manifest/0.2 (+https://supplystudies.com/manifest/)"},json:!0})}},n=url.parse(e.url,!0).query;"smap"!=n.type&&"gsheet"!=n.type||(s=e=null,"smap"==n.type&&(e=r.getSmapGeo,s=r.getSmapGraph),"gsheet"==n.type&&(e=r.getGoogleOverview,s=r.getGoogleList),e(n.id).then(function(e){r.g=e,s(n.id).then(function(e){r.r=e,t.statusCode=200,t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept"),t.setHeader("Access-Control-Allow-Methods","GET"),t.setHeader("Content-Type","application/json"),console.log("process success!"),t.end('{"g": '+JSON.stringify(r.g)+', "r": '+JSON.stringify(r.r)+"}")})}).catch(function(e){console.log("failure!"),t.statusCode=404,t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept"),t.setHeader("Access-Control-Allow-Methods","GET"),t.setHeader("Content-Type","application/json"),t.end('{"error: "RESOURCE NOT FOUND"}')})),"proxy-marine"==n.type&&r.getMarineTrafficOverview().then(function(e){t.statusCode=200,t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept"),t.setHeader("Access-Control-Allow-Methods","GET"),t.setHeader("Content-Type","application/json"),console.log("proxy success!"),t.end(JSON.stringify(e))}).catch(function(e){console.log("failure!"),t.statusCode=404,t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept"),t.setHeader("Access-Control-Allow-Methods","GET"),t.setHeader("Content-Type","application/json"),t.end('{"error: "RESOURCE NOT FOUND"}')}),"aprsfi"==n.type&&r.getAprsFi(n.id).then(function(e){t.statusCode=200,t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept"),t.setHeader("Access-Control-Allow-Methods","GET"),t.setHeader("Content-Type","application/json"),console.log("proxy success!"),t.end(JSON.stringify(e))}).catch(function(e){console.log("failure!"),t.statusCode=404,t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept"),t.setHeader("Access-Control-Allow-Methods","GET"),t.setHeader("Content-Type","application/json"),t.end('{"error: "RESOURCE NOT FOUND"}')})});server.listen(port,hostname,()=>{console.log(`Server running at http://${hostname}:${port}/`)});